---
import Layout from '../layouts/Layout.astro';
import GeneralSettings from '../components/app/pages/Settings.svelte';
import Header from '../components/app/lib/Header.svelte';
import { lucia } from '../lib/lucia';
import { DUMMY_SESSION } from '../lib/helpers';

let session = DUMMY_SESSION;
let sessionID = 'some-id';

const AC_ENABLED = Boolean(process.env.M0N1T0R_ENABLE || false);

if (!import.meta.env.DEV) {
    if (!Astro.locals.user) return Astro.redirect('/login');
    if (Astro.locals.user.is_blocked) {
        await lucia.invalidateUserSessions(Astro.locals.user.id);
        return Astro.redirect('/login');
    }
    if (!Astro.locals.user.is_verified) {
        return Astro.redirect('/verify/email');
    }
    session = { ...Astro.locals.user };
    sessionID = Astro.locals.session.id;
}
---

<Layout title="Admin">
    <Header
        username={session.username}
        interactive={true}
        client:visible
    />
    <div transition:animate="fade" class="flex flex-1 justify-center">
        <GeneralSettings session={session} sessionID={sessionID} ac={AC_ENABLED} client:visible />
    </div>
</Layout>
